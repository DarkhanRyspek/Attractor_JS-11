SELECT DISTINCT a.f_i, a.id, a.acnt_contract__oid,
                trunc(nvl(OWS.glob.LDATEACNT(a.acnt_contract__oid), OWS.glob.GET_DB_DATE_WS)) CurrDate
  FROM OWS.usage_action u, OWS.event_type t, OWS.acnt_contract a
 WHERE u.event_type = t.id
       AND t.code = ('CARD_AUTO_RENEW')
       and t.amnd_state='A'
       AND u.acnt_contract__id = a.id
       --AND A.ID = 12780793  8262478
       AND A.ID IN (SELECT S.ID1 FROM SBERBANK_CUST.TEMP_WT S WHERE S.INFORM = 'CARD_AUTO_RENEW')
       AND a.amnd_state = 'A' AND a.pcat = 'C' AND a.con_cat = 'C'
       AND OWS.decr.GET_STATUS_CODE(a.id, NULL, NULL, 'AUTO_CL_IS_ACTIVE') = 'Y'
       AND (a.date_expire > nvl(OWS.glob.LDATEACNT(a.acnt_contract__oid),
                OWS.glob.GET_DB_DATE_WS) OR a.date_expire IS NULL)
                
       AND a.card_expire > to_char(nvl(OWS.glob.LDATEACNT(a.acnt_contract__oid), OWS.glob.GET_DB_DATE_WS), 'yymm')
       AND u.id = (SELECT MAX(uu.id) FROM OWS.usage_action uu
                   WHERE u.event_type = uu.event_type AND u.acnt_contract__id = uu.acnt_contract__id)
       AND NOT EXISTS (SELECT 1 FROM OWS.card_info c WHERE c.acnt_contract__oid = a.id AND c.date_from > u.start_date)
       


**********************************
-- delete from SBERBANK_CUST.TEMP_WT S where S.INFORM  = 'CARD_AUTO_RENEW';
-- INSERT INTO SBERBANK_CUST.TEMP_WT (ID1,INFORM)
SELECT U.ACNT_CONTRACT__ID,'CARD_AUTO_RENEW'
  FROM OWS.USAGE_ACTION U
 WHERE u.event_type = 3485
       --AND U.ACNT_CONTRACT__ID=12780793
       AND NOT EXISTS (SELECT * FROM OWS.ACNT_CONTRACT C
                   WHERE C.ID=U.ACNT_CONTRACT__ID AND C.AMND_STATE='A'
                   AND C.IS_READY='C' AND C.CONTR_STATUS=109)
group by u.ACNT_CONTRACT__ID;
 

SELECT T.*
  FROM OWS.event_type t
 WHERE t.amnd_state='A' AND t.code = ('CARD_AUTO_RENEW');
 
 
SELECT COUNT(*)
  FROM SBERBANK_CUST.TEMP_WT S
 WHERE S.INFORM = 'CARD_AUTO_RENEW'
 --328950